<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>routes\projects.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Model.html">Model</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/model.html">model</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: routes\projects.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
//var config = require(__dirname + &#x27;/../config/config.json&#x27;);
var utils = require(__dirname + &#x27;/../utils/utils&#x27;);
var error = require(__dirname + &#x27;/../utils/error&#x27;);
var project = require(__dirname + &#x27;/../models/project&#x27;);


exports.findById = function(req, res) {

  project.findById(req.params.id, function(data, err) {
    utils.sendResult(res, data, err);
  });
};

/**
 * Called with /projects
 * Retrieves all specified projects.
 * 
 * REST parameters (in query string):
 *   - fields ... specify list of fields to be delivered. All other fields are ignored. If unknown fields
 *       are specified here, they will be silently ignored. The list of fields must be comma-separated.
 *   - set ... specify set of projects to be returned, can be one of the following values:
 *       all ... all projects in the database
 *       active ... only active projects (with attribute &quot;active&quot;)
 *   - add ... add a specific record into the result set, the value of the parameter is the
 *       project_id of the record to be added to the result set. This record will be
 *       included in the result set in any case, regardless of the other query parameters.
 */
exports.findAll = function(req, res) {

	logger.verbose(&#x27;---------------------------------&#x27;);
	logger.verbose(&#x27;[&#x27; +  (new Date()).toLocaleTimeString() + &#x27;] Query (find all) called...&#x27;);
	logger.verbose(&#x27;  Query parameters: &#x27; + JSON.stringify(req.query, undefined, 2));

	// parse parameters
	// ----------------

	var constraints = [ &#x27;1=1&#x27;], // find constraints
		include, // a project_id which should always be in the result set
		fields; // list of fields to be included in the output

	if (req.query.set) {
		// specifies the set of projects (default, if &#x27;set&#x27; 
		// is omitted: &#x27;active&#x27;, thus requesting only active projects)
		switch(req.query.set) {
			case &#x27;all&#x27;: break;
			case &#x27;active&#x27;: constraints.push(&#x27;active&#x27;); break;
		}
	} else {
		// default: query only active projects
		constraints.push(&#x27;active&#x27;); 
	}
	if (req.query.add) {
		// parameter &quot;add&quot; will include a specific record into the result set,
		// regardless of other contraints
		include = parseInt(req.query.add);
	}

	if (req.query.fields) {
		fields = req.query.fields.split(&#x27;,&#x27;);
	}

	// let&#x27;s fetch the data
	// --------------------

	// build query
	var where;
	if (include) {
		where = &#x27;((&#x27; + constraints.join(&#x27; and &#x27;) + &#x27;) or project_id=&#x27; + include + &#x27;)&#x27;;
	} else {
		where = &#x27;&#x27; + constraints.join(&#x27; and &#x27;);
	}
	var sql = &quot;SELECT p.project_id, p.name, p.abbreviation, p.active &quot; 
				+ &quot; from projects p where &quot; + where + &quot; order by p.name&quot;;
	logger.verbose(&#x27;sql = [&#x27; + sql + &#x27;]&#x27;);

	dbPool.getConnection(function(err, connection) {

		// Query the database to some data 
		connection.query(sql, function(err, rows) {
			logger.verbose(&#x27;   ... got answer from DB server&#x27;);

			if (err != null) {
				res.send(404, &quot;Query error:&quot; + err);
			} else {

				rows = utils.changeKeysToCamelCase(rows);
				if (fields) {
					rows = utils.filterProperties(rows, fields);
				}
				res.send(200, rows);
			}
		});

		// close connection
		connection.release();
	});
};

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
